---
title: "IBS<img src='AHRM.png' style='float: right; width: 200px;'/>"
author: "AHRM"
# output: html_document
always_allow_html: true
output:
  html_document:
    code_folding: hide
    df_print: paged
    css: style.css
  pdf_document: default
  word_document: default
  # github_document: default
  fig_caption: yes
  keep_md: yes
  number_sections: yes
  toc: yes
  toc_depth: 2
  logo: "AHRM.png"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## **Analysis of IBS-Smart/Trio-Smart vs Control on IBS-specific medications** {.tabset .tabset-fade .tabset-pills}
### Medications by Encounters{.tabset}
#### Sankey graph{.tabset}
##### Intervention (IBS/TRIO/Both)
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
# pacman checks and installs the required packages if not installed already 
# knitr::include_graphics("")
pacman::p_load(highcharter, htmlwidgets, dplyr, readr, ggplot2, webshot, readxl, officer, tidyr, msm, downloadthis, flextable, MatchIt, cobalt) 
load("E:/AHRM/Data/propensity/dt_test_prep.Rdata")

# Pulling data into R-console
ibs3 <- read_excel("E:\\AHRM\\Data\\propensity\\ibs3.xlsx")
ibs3t <- read_excel("E:\\AHRM\\Data\\propensity\\ibs3t.xlsx")
ibs3t2 <- ibs3t %>% select(id, group, Day, drug_class) %>% 
  pivot_wider(names_from = Day, values_from = drug_class) %>% 
  mutate(grp = case_when(group == 'control'~'control', TRUE ~ 'int')) %>%
  select(-c(id,group)) %>% select(grp, rx1_class, rx2_class, rx3_class, rx4_class, rx5_class, rx6_class)

control <- ibs3t2 %>% filter(grp == 'control')
ibssmart <- ibs3t2 %>% filter(grp == 'int')

ibs3t_ibs <- ibs3t %>% select(id, group, Day, drug_class) %>% 
  filter(group == 'ibs-smart ONLY') %>%
  pivot_wider(names_from = Day, values_from = drug_class) %>%
  select(group, rx1_class, rx2_class, rx3_class, rx4_class, rx5_class, rx6_class)

ibs3t_trio <- ibs3t %>% select(id, group, Day, drug_class) %>% 
  filter(group == 'trio-smart ONLY') %>%
  pivot_wider(names_from = Day, values_from = drug_class) %>%
  select(group, rx1_class, rx2_class, rx3_class, rx4_class, rx5_class, rx6_class)

ibs3t_both <- ibs3t %>% select(id, group, Day, drug_class) %>% 
  filter(group == 'ibs-smart AND trio-smart') %>%
  pivot_wider(names_from = Day, values_from = drug_class) %>%
  select(group, rx1_class, rx2_class, rx3_class, rx4_class, rx5_class, rx6_class)

# Making the Sankey diagram using hchart function
int_sankey <- hchart(data_to_sankey(ibssmart), "sankey", name = "Sankey")
ctrl_sankey <- hchart(data_to_sankey(control), "sankey", name = "Sankey")
ibs_sankey <- hchart(data_to_sankey(ibs3t_ibs), "sankey", name = "Sankey")
trio_sankey <- hchart(data_to_sankey(ibs3t_trio), "sankey", name = "Sankey")
ibstrio_sankey <- hchart(data_to_sankey(ibs3t_both), "sankey", name = "Sankey")

# Adding customization
p1int<- int_sankey %>% 
  hc_title(text = "Flow of Drug Classes Between Encounters") %>%
  hc_subtitle(text = "<bold>Intervention Group</bold>") %>%
  hc_caption(text = "<b>
 Footnote:<br>
 Gastromotility agents include Erythromycin, Naltrexone among other drugs <br>
 Anti-infective agents include Xifaxan, Zovirax 
 <b>") %>%
  hc_add_theme(hc_theme_economist())

# -----------------------------------------------------
p1ctrl<- ctrl_sankey %>% 
  hc_title(text = "Flow of Drug Classes Between Encounters") %>%
  hc_subtitle(text = "Control Group") %>%
  hc_caption(text = "<b>
 Footnote:<br>
 Gastromotility agents include Erythromycin, Naltrexone among other drugs <br>
 Anti-infective agents include Xifaxan, Zovirax 
 <b>")  %>%
  hc_add_theme(hc_theme_economist())
# -----------------------------------------------------
p1ibs<- ibs_sankey %>% 
  hc_title(text = "Flow of Drug Classes Between Encounters") %>%
  hc_subtitle(text = "IBS Only Group") %>%
  hc_caption(text = "<b>
 Footnote:<br>
 Gastromotility agents include Erythromycin, Naltrexone among other drugs <br>
 Anti-infective agents include Xifaxan, Zovirax 
 <b>")  %>%
  hc_add_theme(hc_theme_economist())
# -----------------------------------------------------
p1trio<- trio_sankey %>% 
  hc_title(text = "Flow of Drug Classes Between Encounters") %>%
  hc_subtitle(text = "Trio-Smart Only Group") %>%
  hc_caption(text = "<b>
 Footnote:<br>
 Gastromotility agents include Erythromycin, Naltrexone among other drugs <br>
 Anti-infective agents include Xifaxan, Zovirax 
 <b>")  %>%
  hc_add_theme(hc_theme_economist())
# -----------------------------------------------------
p1ibstrio<- ibstrio_sankey %>% 
  hc_title(text = "Flow of Drug Classes Between Encounters") %>%
  hc_subtitle(text = "IBS & Trio-Smart Combined Group") %>%
  hc_caption(text = "<b>
 Footnote:<br>
 Gastromotility agents include Erythromycin, Naltrexone among other drugs <br>
 Anti-infective agents include Xifaxan, Zovirax 
 <b>")  %>%
  hc_add_theme(hc_theme_economist())
# -------------------------------------------------------
# Saving as html on local drive
htmlwidgets::saveWidget(widget = p1int, file = "E:\\AHRM\\Data\\propensity\\ibs\\p1int.html")
htmlwidgets::saveWidget(widget = p1ctrl, file = "E:\\AHRM\\Data\\propensity\\ibs\\p1ctrl.html")
htmlwidgets::saveWidget(widget = p1ibs, file = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibs.html")
htmlwidgets::saveWidget(widget = p1trio, file = "E:\\AHRM\\Data\\propensity\\ibs\\p1trio.html")
htmlwidgets::saveWidget(widget = p1ibstrio, file = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibstrio.html")

# For generating png file, install phantomjs()
# webshot::install_phantomjs()

# Save as png from the html file generated earlier
# webshot::install_phantomjs()
# Save as png from the html file generated earlier
# webshot::webshot(url="E:\\AHRM\\Data\\propensity\\p1int.html", file = "E:\\AHRM\\Data\\propensity\\ibs\\p1int.png", delay=10,
#                   vwidth = 1200, vheight = 800, cliprect = "viewport")
# 
# webshot::webshot(url="E:\\AHRM\\Data\\propensity\\p1ctrl.html", file = "E:\\AHRM\\Data\\propensity\\ibs\\p1ctrl.png", delay=10, vwidth = 1200, vheight = 800, cliprect = "viewport")
# webshot::webshot(url="E:\\AHRM\\Data\\propensity\\ibs\\p1ibs.html", file = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibs.png", delay=10, vwidth = 1200, vheight = 800, cliprect = "viewport")
# webshot::webshot(url="E:\\AHRM\\Data\\propensity\\ibs\\p1trio.html", file = "E:\\AHRM\\Data\\propensity\\ibs\\p1trio.png", delay=10, vwidth = 1200, vheight = 800, cliprect = "viewport")
# webshot::webshot(url="E:\\AHRM\\Data\\propensity\\ibs\\p1ibstrio.html", file = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibstrio.png", delay=10, vwidth = 1200, vheight = 800, cliprect = "viewport")
# --------------------------------------------

ibs3t <- ibs3t %>% mutate(gr = case_when(group == 'control' ~ 'control', TRUE ~ 'intervention'))

ibs3ti <- ibs3t %>% filter(gr == 'intervention')
ibs3tc <- ibs3t %>% filter(gr == 'control')
ibs3tibs <- ibs3t %>% filter(group == 'ibs-smart ONLY')
ibs3ttrio <- ibs3t %>% filter(group == 'trio-smart ONLY')
ibs3tibstrio <- ibs3t %>% filter(group == 'ibs-smart AND trio-smart')

std_border <- fp_border(color = "gray")
# -------------------------------------------------------------------------
trans_i <- statetable.msm(drug, id, data = ibs3ti) %>% 
  as_flextable(include.column_percent = FALSE, include.table_percent = FALSE,
include.row_percent = TRUE) %>% 
  theme_booktabs() %>%               
  autofit() %>%                      
  padding(padding = 1, part = "all") %>% 
  fontsize(size = 10, part = "all") %>%
  set_caption(
    as_paragraph(
      as_chunk("Transitional probabilities of medication switching for IBS/Trio/Both", props = fp_text_default(font.family = "Garamond", font.size = 14))
    ), word_stylename = "Table Caption"
  )

trans_i <- hline(x = trans_i, part = "all", border = std_border)
# State transitions row by row
# trans_ip <- round(100*prop.table(trans_i, 1),1)
# trans_ipdf <- as.data.frame(trans_ip)
my_border <- fp_border(color = "black", width = 1, style = "solid")
trans_c <- statetable.msm(drug, id, data = ibs3tc) %>% 
  as_flextable(include.column_percent = FALSE, include.table_percent = FALSE,
include.row_percent = TRUE) %>% 
  theme_booktabs() %>%               
  autofit() %>%                      
  padding(padding = 1, part = "all") %>% 
  fontsize(size = 10, part = "all") %>%
  set_caption(
    as_paragraph(
      as_chunk("Transitional probabilities of medication switching for Controls", props = fp_text_default(font.family = "Garamond", font.size = 14))
    ), word_stylename = "Table Caption"
  )

trans_c <- hline(x = trans_c, part = "all", border = std_border)
# trans_c2 <- statetable.msm(drug, id, data = ibs3tc) 
# State transitions row by row
# trans_cp <- round(100*prop.table(trans_c2, 1),1) 
 
# trans_cpdf <- as.data.frame(trans_cp)

# ------------------------------------------------------------------------
ibs3tibs <- ibs3t %>% filter(group == 'ibs-smart ONLY')
trans_ibs <- statetable.msm(drug, id, data = ibs3tibs) %>% 
  as_flextable(include.column_percent = FALSE, include.table_percent = FALSE,
include.row_percent = TRUE) %>% 
  theme_booktabs() %>%               
  autofit() %>%                      
  padding(padding = 1, part = "all") %>% 
  fontsize(size = 10, part = "all") %>%
  set_caption(
    as_paragraph(
      as_chunk("Transitional probabilities of medication switching for IBS Only Group", props = fp_text_default(font.family = "Garamond", font.size = 14))
    ), word_stylename = "Table Caption"
  )

trans_ibs <- hline(x = trans_ibs, part = "all", border = std_border)
# ------------------------------------------------------------------------
# ------------------------------------------------------------------------
ibs3ttrio <- ibs3t %>% filter(group == 'trio-smart ONLY')
trans_trio <- statetable.msm(drug, id, data = ibs3ttrio) %>% 
  as_flextable(include.column_percent = FALSE, include.table_percent = FALSE,
include.row_percent = TRUE) %>% 
  theme_booktabs() %>%               
  autofit() %>%                      
  padding(padding = 1, part = "all") %>% 
  fontsize(size = 10, part = "all") %>%
  set_caption(
    as_paragraph(
      as_chunk("Transitional probabilities of medication switching for Trio-Smart Only Group", props = fp_text_default(font.family = "Garamond", font.size = 14))
    ), word_stylename = "Table Caption"
  )

trans_trio <- hline(x = trans_trio, part = "all", border = std_border)
# ------------------------------------------------------------------------
# ------------------------------------------------------------------------
ibs3tibstrio <- ibs3t %>% filter(group == 'ibs-smart AND trio-smart')
trans_ibstrio <- statetable.msm(drug, id, data = ibs3tibstrio) %>% 
  as_flextable(include.column_percent = FALSE, include.table_percent = FALSE,
include.row_percent = TRUE) %>% 
  theme_booktabs() %>%               
  autofit() %>%                      
  padding(padding = 1, part = "all") %>% 
  fontsize(size = 10, part = "all") %>%
  set_caption(
    as_paragraph(
      as_chunk("Transitional probabilities of medication switching for IBS & Trio-Smart Combined Group", props = fp_text_default(font.family = "Garamond", font.size = 14))
    ), word_stylename = "Table Caption"
  )

trans_ibstrio <- hline(x = trans_ibstrio, part = "all", border = std_border)
# ------------------------------------------------------------------------


p1int

download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1int.png",
  output_name = "Figure 1 Medications IBS/TRIO/Both" ,
  button_label = "download (.png)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1int.html",
  output_name = "Figure 1 Medications IBS/TRIO/Both" ,
  button_label = "download interactive (.html)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
```

>**Flow of Drug Classes Between Clinical Encounters in the Intervention Group.**
The Sankey diagram illustrates longitudinal transitions in medication class use across six successive clinical encounters among participants in the intervention group. Each vertical column represents one encounter (rx1 through rx6), and each colored node corresponds to a distinct drug class, including gastro‑motility agents, anti-infective agents, antidepressants, anxiolytics, antiallergics, proton pump inhibitors/H2 blockers (PPI/H2B), and an “other” category. <br>
The width of each flow is proportional to the number of participants whose medication class changed or remained stable between encounters.<br>
Early encounters (rx1–rx2) show substantial initiation of gastro‑motility agents and PPI/H2B therapies, while anti-infective and antiallergic agents appear less frequently. Across encounters, the “other” medication category remains a dominant pathway, indicating frequent transitions into heterogeneous or infrequently used drug classes.<br>
By later encounters (rx5–rx6), gastro‑motility agents again form a major proportion of flows, suggesting recurrent or persistent prescribing patterns in this class.<br>
The diagram highlights both persistence (e.g., continuing gastro‑motility therapy across multiple encounters) and variability in medication use, with numerous cross‑class transitions. 

##### Control
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
p1ctrl
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1ctrl.png",
  output_name = "Figure 1 Medications Control" ,
  button_label = "download (.png)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1ctrl.html",
  output_name = "Figure 1 Medications Control" ,
  button_label = "download interactive (.html)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
```

> Similar graph for the control group is shown above.
> These graphs reveal distinct patterns in prescribing behavior and medication stability between the intervention (IBS-Smart, Trio-Smart, Combined IBS-Smart & Trio-Smart) and control groups.<br>
**Overall Pattern of Medication Transitions**<br>
*Intervention Group:*<br>
The flows show more concentrated transitions, especially through `gastro‑motility agents`, `anti‑infective agents`, and `PPI/H2B classes`.<br>
The “other” medication category is consistently prominent but becomes especially dominant around rx3–rx5, indicating broad shifts into miscellaneous or less frequent drug classes.<br>
*Control Group:*<br>
The flows appear more diffuse, with a wider variety of medication classes represented (e.g., `antidiarrheal`, `analgesic`).<br>
Medications are more heterogeneous across encounters, suggesting less clustering into specific therapeutic classes.<br>

##### IBS only
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
p1ibs
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibs.png",
  output_name = "Figure 1 Medications IBS only" ,
  button_label = "download (.png)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibs.html",
  output_name = "Figure 1 Medications IBS only" ,
  button_label = "download interactive (.html)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
```

##### Trio-Smart only
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
p1trio
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1trio.png",
  output_name = "Figure 1 Medications Trio Only Group" ,
  button_label = "download (.png)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1trio.html",
  output_name = "Figure 1 Medications Trio Only Group" ,
  button_label = "download interactive (.html)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
```


##### IBS & Trio-Smart 
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
p1ibstrio
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibstrio.png",
  output_name = "Figure 1 Medications IBS & Trio-Smart Combined" ,
  button_label = "download (.png)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
download_file(
  path = "E:\\AHRM\\Data\\propensity\\ibs\\p1ibstrio.html",
  output_name = "Figure 1 Medications IBS & Trio-Smart Combined" ,
  button_label = "download (.html)",
  button_type = "primary",
  has_icon = TRUE,
  self_contained = TRUE
)
```


#### Transitional Probabilities {.tabset}
##### Intervention (IBS/TRIO/Both)
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
trans_i
```

> The transition matrix for the intervention group quantitatively supports the Sankey visualization. Consistent with the prominent ‘other’ nodes and thick connecting bands in the Sankey, ‘other’ was the most frequent destination class (271/420 transitions, ~64.5%) and showed high persistence (other→other: 189/250, 75.6%).<br> 
  + Gastro‑motility agents were also common and exhibited partial stability (gastro→gastro: 21/72, 29.2%) with frequent transitions to ‘other’ (gastro→other: 30/72, 41.7%) and to PPI/H2B (9/72, 12.5%). <br>
  + Anti‑infective transitions often moved toward gastro‑motility (12/33, 36.4%) or ‘other’ (10/33, 30.3%), consistent with the cross‑class flows shown in the Sankey. <br>
  + Differences between the table and figure largely reflect that the table pools transitions across all encounter intervals, whereas the Sankey displays encounter-specific flow patterns. The Sankey is “time-resolved”; the table is “time-collapsed”. If a transition occurs mostly early (e.g., rx1→rx2) but not later, the Sankey will show that timing. The table will average it into one number.

##### Control
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
trans_c
```

> Medication transitions differed between groups. In the intervention group, movements into the “other” class were most frequent (64.5% of all transitions), with strong persistence within this category (other→other: 75.6%) and notable stability in gastro‑motility agents (gastro→gastro: 29.2%). <br>

> In contrast, the control group showed more heterogeneous switching patterns, including greater involvement of PPI/H2B and analgesic classes and lower stability within both “other” (67.4%) and gastro‑motility (17.6%). <br> 

>Controls also exhibited more frequent transitions from and into PPI/H2B, whereas in the intervention group, anti‑infective agents more often shifted toward gastro‑motility (36.4% vs. 20.6%).  <br>

>Overall, the transition matrices support the Sankey visualizations: the intervention group demonstrated more consistent medication trajectories, while the control group showed broader and less stable class‑to‑class movement.

> In summary, *compared with the intervention transition table, the controls show more PPI/H2B involvement, greater switching from gastro‑motility into “other,” and lower persistence within “other” and gastro‑motility. The intervention table shows greater continuity (especially other → other and gastro → gastro) and stronger anti‑infective → gastro‑motility transitions.*

##### ibs-smart ONLY 
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
trans_ibs
```

##### trio-smart ONLY
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
trans_trio
```

##### ibs-smart AND trio-smart 
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show', echo=FALSE}
trans_ibstrio
```


#### Propensity Score Matching {.tabset}
##### IBS-Smart {.tabset}
###### Summary
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show'}
dt_test_prep <- dt_test_prep %>% mutate(ibssmart = case_when(is.na(ibs_smart)~0, TRUE~ibs_smart))                
mod_matchibs <- matchit(ibssmart ~ age+ history_before_2019+MCAS_first_visit+IBS_D_first_visit+refer_y, 
                     method = "nearest", 
                     data = dt_test_prep)
summary(mod_matchibs)
```

###### eQQ Plot
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show'}
plot(mod_matchibs)
```

###### Covariate balance
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show'}
love.plot(mod_matchibs)   
```

> Figure presents a love plot summarizing covariate balance before (unadjusted; red) and after (adjusted; teal) the propensity-score–based adjustment for the IBS-Smart group and matched controls.<br> 

  + The x‑axis shows the (standardized) mean difference between comparison groups for each covariate, with the vertical line at 0 indicating perfect balance.<br>
  + In the unadjusted sample, several baseline characteristics exhibited meaningful imbalance, with standardized mean differences generally in the range of approximately −0.1 to −0.35 for variables such as `age`, `history_before_2019`, `MCAS_first_visit`, `IBS_D_first_visit`, and `refer_y_.` In addition, the propensity score distance measure showed substantial separation between groups (large positive mean difference), consistent with strong baseline differences in treatment assignment prior to adjustment.<br>
  + After adjustment, the covariate mean differences moved markedly toward zero across all measured characteristics, indicating improved balance between groups. Most covariates cluster tightly around 0, suggesting the adjustment procedure was effective in reducing systematic baseline differences; the largest residual differences appear modest relative to the unadjusted sample.

##### TRIO-Smart {.tabset}
###### Summary
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show'}
dt_test_prep <- dt_test_prep %>% mutate(triosmart_dv = case_when(is.na(trio_smart_dv)~0, TRUE~trio_smart_dv))                
mod_matchts <- matchit(triosmart_dv ~ history_before_2019 +ibs_first_visit +SIBO_first_visit  ,
                                      method = "nearest", data = dt_test_prep)
                 
summary(mod_matchts)
```

###### eQQ Plot
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show'}
plot(mod_matchts)
```

###### Covariate balance
```{r class.source = 'fold-hide', warning=FALSE,  message=FALSE, results='show'}
love.plot(mod_matchts)   
```

> Figure displays a covariate balance plot (love plot) comparing standardized mean differences between study groups before (unadjusted; red) and after (adjusted; teal) application of the propensity-score–based adjustment. The variables assessed include `history_before_2019`, `ibs_first_visit`, `SIBO_first_visit`, and the propensity score `distance` metric.<br>

  + In the unadjusted sample, several covariates show notable imbalance, with standardized mean differences ranging roughly from –0.20 to –0.35 for clinical history variables, and a large positive imbalance for the distance metric, indicating substantial baseline separation between groups prior to adjustment.<br>
  + After adjustment, all covariates shift sharply toward zero, with adjusted mean differences clustering tightly at or near 0. This pattern indicates that the adjustment procedure successfully improved covariate balance across all measured characteristics, substantially reducing baseline confounding.
  